<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <style type="text/css">
        .panel panel-default {
            height:600px;
            overflow-y:scroll;
            padding-bottom: 50px;
            }
    </style>

<div class='container'>
<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading"><h2>Chat Box</h2></div>
  <!-- List group -->
  <table  id="refresh" class="table">
  <tbody>
  {% if unicode_list %}
    {% for item in unicode_list %}  
    <tr><td class="list-group-item"> {{item}} </td></tr>
    {% endfor %}
  {% else %}
    <tr><td class="list-group-item"> No message to display...</td></tr>
  {% endif %}
  </tbody>
  </table>

<div class="panel-footer">
<div class="row white">
    <table class="table">
    <tbody>
    <tr>
    <div class="columns large-12">
        <form method="POST" id="post-form">

            <td><div class="fieldWrapper" id="the_post" class="form-control" type="text">
                {{ form.message_text }}
            </div></td>
            <td> <input type="submit" value="Post" class="btn btn-success"></td>
        </form>
    </div>
    </tr>
    </tbody>
    </table>
</div>
</div>
</div>
</div>




<script>
$(function() {

	 $('#post-form').on('submit', function(event){
    event.preventDefault();
    console.log("form submitted!")  // sanity check
    create_post();
});

    // AJAX for posting
    function create_post() {
        console.log("create post is working!") // sanity check
        $.ajax({
            url : "new_message/", // the endpoint
            type : "POST", // http method
            data : { the_post : $('#post-form').val() }, // data sent with the post request
            // handle a successful response
            success : function(json) {
                $('#post-text').val(''); // remove the value from the input
                console.log(json); // log the returned json to the console
                console.log("success"); // another sanity check
            },
            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                    " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        });
    };

  
       setInterval(function(){my_function() }, 2000); 
     
    function my_function(){
      $.getJSON('/content',
        function(data){
      $('#refresh li:last').after(<li class="list-group-item">data.answ<li>)
    });
    };

});
</script>






